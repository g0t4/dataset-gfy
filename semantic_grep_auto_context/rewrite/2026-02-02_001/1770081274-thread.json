{
  "request_body":{
    "temperature":1,
    "stream":true,
    "max_tokens":2048,
    "messages":[{
        "content":"## Ground rules:\n- Follow the user's instructions. \n- DO NOT wrap answers in markdown code blocks, which means no triple backticks like ``` nor single backtick like ` .\n- Do not explain answers, just give me code. \n- If changing existing code, preserve unrelated code and comments. \n- Never add comments to the end of a line. \n- Never add stupid comments.\n- Be considerate with indentation. \n- Prefer readable code over of comments. \n- Prefer meaningful names for variables, functions, etc. Avoid ambiguous names.",
        "role":"system"
      },{
        "content":"## General Code Preferences\n\n- When rewriting code, leave unrelated code and unrelated comments as is.\n- When an if statement has an AMBIGUOUS condition, extract a variable to meaningfully name it, for example:\n```lua\nlocal is_blank_line = line:match(\"^%s*$\")\nif is_blank_line then\n    -- ...\nend\n```\n",
        "role":"user"
      },{
        "content":"## Python Code Preferences\n- Use snake_case for functions and variables.\n- Use PascalCase for classes.\n- Use type hints to clear up ambiguity and improve code completion.\n- prefer `list[]` over `List[]` to mimimize imports\n- Avoid docstrings, ABSOLUTELY NO trivial comments.\n\n",
        "role":"user"
      },{
        "content":"# Semantic Grep matches: 5\n\nThis is automatic context based on my request. These may or may not be relevant.\n## ~/repos/github/g0t4/dotfiles/fish/load_last_interactive_only/pythons/av/dropped_frames_tests.py:0-7\nimport numpy as np\nfrom numpy._typing import NDArray\nimport rich\nfrom dropped_frames import find_missing_frames\n\nclass TestMissingFrames:\n\n    \n\n## ~/repos/github/g0t4/dotfiles/fish/load_last_interactive_only/pythons/av/dropped_frames_tests.py:82-101\n\n\n    def test_actual_ffmpeg_samples_that_are_truncated(self):\n        # turncation is a good test for closeness (to a frame)\n        timestamps=np.array(\n              [0.      , 0.033333, 0.066667, 0.1     , 0.133333, 0.166667, \\\n               0.2     , 0.233333, 0.266667, 0.3     , 0.333333, 0.366667,\n               0.4     , 0.433333, 0.466667, 0.5     , 0.533333, 0.566667,\n               0.6     , 0.633333, 0.666667, 0.7     , 0.733333, 0.766667,\n               0.8     , 0.833333, 0.866667, 0.9     , 0.933333, 0.966667,\n               1.      , 1.033333, 1.066667, 1.1     , 1.133333, 1.166667,\n               1.2     , 1.233333, 1.266667, 1.3     , 1.333333, 1.366667,\n               1.4     , 1.433333, 1.466667, 1.5     , 1.533333, 1.566667,\n               1.6     , 1.633333, 1.666667, 1.7     , 1.733333, 1.766667,\n               1.8     , 1.833333, 1.866667, 1.9     , 1.933333, 1.966667,\n               2.      , 2.033333, 2.066667, 2.1     , 2.133333, 2.166667,\n               2.2     , 2.233333, 2.266667, 2.3     , 2.333333, 2.366667,\n               2.4     , 2.433333, 2.466667, 2.5     , 2.533333, 2.566667,\n               2.6     , 2.633333, 2.666667, 2.7     , 2.733333, 2.866667,\n               2.933333, 2.966667, 3.      , 3.033333, 3.066667, 3.1     ,\n\n\n## ~/repos/github/g0t4/dotfiles/fish/load_last_interactive_only/pythons/av/dropped_frames_tests.py:38-42\n    def test_last_missing(self):\n        timestamps: NDArray[np.float64] = np.array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [8.0, 9.0]\n        assert extras == []\n\n## ~/repos/github/g0t4/dotfiles/fish/load_last_interactive_only/pythons/av/dropped_frames_tests.py:32-36\n    def test_first_missing(self):\n        timestamps: NDArray[np.float64] = np.array([2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [0.0, 1.0]\n        assert extras == []\n\n## ~/repos/github/g0t4/dotfiles/fish/load_last_interactive_only/pythons/av/dropped_frames_tests.py:5-111\nclass TestMissingFrames:\n\n    def test_negative_are_extras(self):\n        timestamps: NDArray[np.float64] = np.array([-2.0, -1.0, 0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == []\n        expected_extras = np.array([-2.0, -1.0])\n        np.testing.assert_array_equal(extras, expected_extras)\n\n    def test_all_ten_present(self):\n        timestamps: NDArray[np.float64] = np.array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == []\n        assert extras == []\n\n    def test_one_of_ten_is_missing(self):\n        timestamps: NDArray[np.float64] = np.array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 8.0, 9.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [7]\n        assert extras == []\n\n    def test_two_in_a_row_are_missing(self):\n        timestamps: NDArray[np.float64] = np.array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 8.0, 9.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [6.0, 7.0]\n        assert extras == []\n\n    def test_first_missing(self):\n        timestamps: NDArray[np.float64] = np.array([2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [0.0, 1.0]\n        assert extras == []\n\n    def test_last_missing(self):\n        timestamps: NDArray[np.float64] = np.array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [8.0, 9.0]\n        assert extras == []\n\n    def test_negatives_and_first_missing(self):\n        timestamps: NDArray[np.float64] = np.array([-2.0, -1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        expected_missing = np.array([0.0, 1.0])\n        np.testing.assert_array_equal(missing, expected_missing)\n        expected_extras = np.array([-2.0, -1.0])\n        np.testing.assert_array_equal(extras, expected_extras)\n\n    def test_frames_past_end_are_extras(self):\n        timestamps: NDArray[np.float64] = np.array([0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        expected_missing = np.array([])\n        np.testing.assert_array_equal(missing, expected_missing)\n        expected_extras = np.array([10.0, 11.0, 12.0])\n        np.testing.assert_array_equal(extras, expected_extras)\n\n    def test_all_missing(self):\n        timestamps: NDArray[np.float64] = np.array([])\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]\n        assert extras == []\n\n    def test_all_missing_with_extras_before(self):\n        timestamps: NDArray[np.float64] = np.array([-1.0]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]\n        assert extras == [-1.0]\n\n    def test_all_missing_with_midframe_extras_before(self):\n        timestamps: NDArray[np.float64] = np.array([-1.5]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]\n        assert extras == [-1.5]\n\n    def test_all_missing_with_midframe_extras_after(self):\n        timestamps: NDArray[np.float64] = np.array([10.5]) / 30\n        missing, extras = find_missing_frames(timestamps, 30, 10)\n        assert missing == [0.0, 1.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0]\n        assert extras == [10.5]\n\n    def test_actual_ffmpeg_samples_that_are_truncated(self):\n        # turncation is a good test for closeness (to a frame)\n        timestamps=np.array(\n              [0.      , 0.033333, 0.066667, 0.1     , 0.133333, 0.166667, \\\n               0.2     , 0.233333, 0.266667, 0.3     , 0.333333, 0.366667,\n               0.4     , 0.433333, 0.466667, 0.5     , 0.533333, 0.566667,\n               0.6     , 0.633333, 0.666667, 0.7     , 0.733333, 0.766667,\n               0.8     , 0.833333, 0.866667, 0.9     , 0.933333, 0.966667,\n               1.      , 1.033333, 1.066667, 1.1     , 1.133333, 1.166667,\n               1.2     , 1.233333, 1.266667, 1.3     , 1.333333, 1.366667,\n               1.4     , 1.433333, 1.466667, 1.5     , 1.533333, 1.566667,\n               1.6     , 1.633333, 1.666667, 1.7     , 1.733333, 1.766667,\n               1.8     , 1.833333, 1.866667, 1.9     , 1.933333, 1.966667,\n               2.      , 2.033333, 2.066667, 2.1     , 2.133333, 2.166667,\n               2.2     , 2.233333, 2.266667, 2.3     , 2.333333, 2.366667,\n               2.4     , 2.433333, 2.466667, 2.5     , 2.533333, 2.566667,\n               2.6     , 2.633333, 2.666667, 2.7     , 2.733333, 2.866667,\n               2.933333, 2.966667, 3.      , 3.033333, 3.066667, 3.1     ,\n               3.133333, 3.166667, 3.2     , 3.233333, 3.266667, 3.3     ,\n               3.333333, 3.366667, 3.4     , 3.433333, 3.466667, 3.5     ,\n               3.533333, 3.566667, 3.6     , 3.633333, 3.666667, 3.7     ,\n               3.733333, 3.766667, 3.8     , 3.833333, 3.866667, 3.9     ,\n               3.933333, 3.966667])\n        missing, extras = find_missing_frames(timestamps, 30, 120)\n\n        expected_missing = [83.0, 84.0, 85.0, 87.0]\n        np.testing.assert_array_equal(missing, expected_missing)\n        assert extras == []\n",
        "role":"user"
      },{
        "content":"use np.close\n\nHere is the code I selected:\n```fish/load_last_interactive_only/pythons/av/dropped_frames.py:331-334\n    if next_pts < expected_pts_duration:\n        print(f\"  [WARNING] audio ends early: {next_pts=} < {expected_pts_duration=}\")\n    if next_pts > expected_duration_seconds:\n        print(f\"  [WARNING] audio runs longer than expected: {next_pts=} > {expected_pts_duration=}\")\n```\n\nThis is not necessarily a complete selection of nearby code, this is just the part I want help with. Preserve indentation!",
        "role":"user"
      }],
    "chat_template_kwargs":{
      "reasoning_effort":"off"
    },
    "model":"",
    "top_p":1
  },
  "last_sse":{
    "choices":[{
        "finish_reason":"stop",
        "index":0,
        "delta":[]
      }],
    "id":"chatcmpl-sJQGvvAaU3FhN8chOdMxr4nO7nqIym12",
    "system_fingerprint":"b7785-1c7cf94b2",
    "object":"chat.completion.chunk",
    "timings":{
      "prompt_per_second":8035.5259409394,
      "prompt_ms":459.833,
      "prompt_per_token_ms":0.12444736129905,
      "predicted_ms":1208.453,
      "predicted_per_token_ms":5.9529704433498,
      "prompt_n":3695,
      "cache_n":0,
      "predicted_per_second":167.98336385445,
      "predicted_n":203
    },
    "created":1770081274,
    "model":"ggml-org/gpt-oss-120b-GGUF"
  },
  "response_message":{
    "finish_reason":"stop",
    "content":"    tolerance = 1e-6\n    is_early = next_pts < expected_pts_duration and not np.isclose(next_pts, expected_pts_duration, atol=tolerance)\n    if is_early:\n        print(f\"  [WARNING] audio ends early: {next_pts=} < {expected_pts_duration=}\")\n    is_late = next_pts > expected_duration_seconds and not np.isclose(next_pts, expected_duration_seconds, atol=tolerance)\n    if is_late:\n        print(f\"  [WARNING] audio runs longer than expected: {next_pts=} > {expected_duration_seconds=}\")",
    "reasoning_content":"We need to modify code to use np.isclose? The snippet prints warnings when next_pts less than expected_pts_duration or greater than expected_duration_seconds (typo maybe). Should use np.isclose to handle floating point tolerance. Replace ambiguous conditions with variables. Use snake_case. Provide code only, no markdown. Preserve indentation. Let's output modified snippet.",
    "role":"assistant"
  }
}