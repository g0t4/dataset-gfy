extract function refactoring + use it in a new loop (too)
